import ft from '@fastify/cors';
import Et from '@fastify/helmet';
import wt from '@fastify/jwt';
import Qt from '@fastify/redis';
import bt from '@fastify/swagger';
import kt from '@fastify/websocket';
import Dt from '@scalar/fastify-api-reference';
import ht from 'fastify';
import { validatorCompiler, serializerCompiler } from 'fastify-type-provider-zod';
import { DefaultLogger, WebsocketClient } from 'bybit-api';
import ue from 'fastify-plugin';
import 'dotenv/config';
import r, { ZodError } from 'zod';
import { WalletContractV1R1, WalletContractV1R2, WalletContractV1R3, WalletContractV2R1, WalletContractV2R2, WalletContractV3R1, WalletContractV3R2, WalletContractV4, Cell, contractAddress, TonClient, Address, internal, beginCell, fromNano, TonClient4, loadStateInit } from '@ton/ton';
import { Buffer } from 'buffer';
import { mnemonicToPrivateKey, sha256 } from '@ton/crypto';
import _ from 'tweetnacl';
import { toNano, contractAddress as contractAddress$1, Slice, beginCell as beginCell$1, TupleBuilder, Dictionary, Builder, Cell as Cell$1 } from '@ton/core';

var Be=async i=>{({...DefaultLogger,silly:(...o)=>console.log("silly",...o)});let e=new WebsocketClient({market:"v5"});i.addHook("onClose",async()=>{e.closeAll();}),i.decorate("bybit",{ws:e});},J=ue(Be);var R=(o=>(o.development="development",o.test="test",o.production="production",o))(R||{}),ce=r.object({NODE_ENV:r.nativeEnum(R),LOG_LEVEL:r.string(),API_HOST:r.string(),API_PORT:r.string(),ALLOWED_ORIGINS:r.string(),REDIS_URI:r.string(),REDIS_TOKEN:r.string(),COOKIE_SECRET:r.string(),JWT_SECRET:r.string(),RPC_PROVIDER_API_KEY:r.string(),DATA_STREAM_ADDRESS:r.string(),MNEMONIC:r.string()}),Ce=async i=>{let t=ce.safeParse(process.env);if(!t.success)throw new Error(".env file validation failed - "+JSON.stringify(t.error,null,2));i.decorate("config",t.data);},v=ue(Ce);var S=(e=>(e.MAINNET="-239",e.TESTNET="-3",e))(S||{});var E=r.enum(["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","TONUSDT"]),H=r.object({start:r.number(),end:r.number(),interval:r.string(),open:r.string(),close:r.string(),high:r.string(),low:r.string(),volume:r.string(),turnover:r.string(),confirm:r.boolean(),timestamp:r.number()});r.object({topic:r.string(),data:r.array(H),ts:r.number(),type:r.string(),wsKey:r.string()});var Ee=r.object({open:r.number(),close:r.number(),high:r.number(),low:r.number(),time:r.number()});r.array(Ee);var x=r.object({op:r.enum(["subscribe"]),args:r.array(E)});var b=class i{static create(t){return t==="-239"&&(t=new TonClient4({endpoint:"https://mainnet-v4.tonhubapi.com"})),t==="-3"&&(t=new TonClient4({endpoint:"https://testnet-v4.tonhubapi.com"})),new i(t)}client;constructor(t){this.client=t;}async getWalletPublicKey(t){let e=await this.client.getLastBlock(),o=await this.client.runMethod(e.last.seqno,Address.parse(t),"get_public_key",[]);return Buffer.from(o.reader.readBigNumber().toString(16).padStart(64,"0"),"hex")}async getAccountInfo(t){let e=await this.client.getLastBlock();return await this.client.getAccount(e.last.seqno,Address.parse(t))}};var G=class{static create(t){let e=WalletContractV4.create(t),{data:o}=e.init,n=Cell.fromBoc(Buffer.from("B5EE9C72410215010002F5000114FF00F4A413F4BCF2C80B010201200203020148040504F8F28308D71820D31FD31FD31F02F823BBF263ED44D0D31FD31FD3FFF404D15143BAF2A15151BAF2A205F901541064F910F2A3F80024A4C8CB1F5240CB1F5230CBFF5210F400C9ED54F80F01D30721C0009F6C519320D74A96D307D402FB00E830E021C001E30021C002E30001C0039130E30D03A4C8CB1F12CB1FCBFF1112131403EED001D0D3030171B0915BE021D749C120915BE001D31F218210706C7567BD228210626C6E63BDB022821064737472BDB0925F03E002FA403020FA4401C8CA07CBFFC9D0ED44D0810140D721F404305C810108F40A6FA131B3925F05E004D33FC8258210706C7567BA9131E30D248210626C6E63BAE30004060708020120090A005001FA00F404308210706C7567831EB17080185005CB0527CF165003FA02F40012CB69CB1F5210CB3F0052F8276F228210626C6E63831EB17080185005CB0527CF1624FA0214CB6A13CB1F5230CB3F01FA02F4000092821064737472BA8E3504810108F45930ED44D0810140D720C801CF16F400C9ED54821064737472831EB17080185004CB0558CF1622FA0212CB6ACB1FCB3F9410345F04E2C98040FB000201200B0C0059BD242B6F6A2684080A06B90FA0218470D4080847A4937D29910CE6903E9FF9837812801B7810148987159F31840201580D0E0011B8C97ED44D0D70B1F8003DB29DFB513420405035C87D010C00B23281F2FFF274006040423D029BE84C600201200F100019ADCE76A26840206B90EB85FFC00019AF1DF6A26840106B90EB858FC0006ED207FA00D4D422F90005C8CA0715CBFFC9D077748018C8CB05CB0222CF165005FA0214CB6B12CCCCC971FB00C84014810108F451F2A702006C810108D718C8542025810108F451F2A782106E6F746570748018C8CB05CB025004CF16821005F5E100FA0213CB6A12CB1FC971FB00020072810108D718305202810108F459F2A7F82582106473747270748018C8CB05CB025005CF16821005F5E100FA0214CB6A13CB1F12CB3FC973FB00000AF400C9ED5446A9F34F","hex"))[0];return e.init={data:o,code:n},e.address=contractAddress(t.workchain,e.init),e}},Te=[{contract:WalletContractV1R1,loadData:F},{contract:WalletContractV1R2,loadData:F},{contract:WalletContractV1R3,loadData:F},{contract:WalletContractV2R1,loadData:X},{contract:WalletContractV2R2,loadData:X},{contract:WalletContractV3R1,loadData:W},{contract:WalletContractV3R2,loadData:W},{contract:G,loadData:j},{contract:WalletContractV4,loadData:j}].map(({contract:i,loadData:t})=>({contract:i,loadData:t,wallet:i.create({workchain:0,publicKey:Buffer.alloc(32)})}));function F(i){let t=i.loadUint(32),e=i.loadBuffer(32);return {seqno:t,publicKey:e}}function X(i){let t=i.loadUint(32),e=i.loadBuffer(32);return {seqno:t,publicKey:e}}function W(i){let t=i.loadUint(32),e=i.loadUint(32),o=i.loadBuffer(32);return {seqno:t,publicKey:o,walletId:e}}function j(i){let t=i.loadUint(32),e=i.loadUint(32),o=i.loadBuffer(32),n=i.loadMaybeRef();return {seqno:t,publicKey:o,walletId:e,plugins:n}}function Z(i){if(!i.code||!i.data)return null;for(let{wallet:t,loadData:e}of Te)try{if(t.init.code.equals(i.code))return e(i.data.beginParse()).publicKey}catch{}return null}var Fe="ton-proof-item-v2/",Ge="ton-connect",Ue=15*60,k=class{generatePayload(){return Buffer.from(_.randomBytes(32)).toString("hex")}async checkProof(t,e){try{let o=loadStateInit(Cell.fromBase64(t.proof.state_init).beginParse()),n=Z(o)??await e(t.address);if(!n)return !1;let a=Buffer.from(t.public_key,"hex");if(!n.equals(a))return !1;let u=Address.parse(t.address),d=contractAddress(u.workChain,o);if(!d.equals(u)||Math.floor(Date.now()/1e3)-Ue>t.proof.timestamp)return !1;let C={workchain:d.workChain,address:d.hash,domain:{lengthBytes:t.proof.domain.lengthBytes,value:t.proof.domain.value},signature:Buffer.from(t.proof.signature,"base64"),payload:t.proof.payload,stateInit:t.proof.state_init,timestamp:t.proof.timestamp},l=Buffer.alloc(4);l.writeUInt32BE(C.workchain,0);let A=Buffer.alloc(8);A.writeBigUInt64LE(BigInt(C.timestamp),0);let B=Buffer.alloc(4);B.writeUInt32LE(C.domain.lengthBytes,0);let h=Buffer.concat([Buffer.from(Fe),l,C.address,B,Buffer.from(C.domain.value),A,Buffer.from(C.payload)]),N=Buffer.from(await sha256(h)),M=Buffer.concat([Buffer.from([255,255]),Buffer.from(Ge),N]),P=Buffer.from(await sha256(M));return _.sign.detached.verify(P,C.signature,n)}catch{return !1}}};var w=class{static async parseKlineTopic(t,e){let o=e.pipeline();o.lrange(t[0],0,-1),o.get(t[1]);let n=await o.exec();if(!n)throw new Error("Failed to fetch data from Redis");let a=(n[0]?.[1]).map(C=>JSON.parse(C)),u=JSON.parse(n[1]?.[1]),d=r.array(H).safeParse(a),s=H.safeParse(u);if(!d.success||!s.success)throw d.error||s.error;return {confirmedCandlesticks:d.data,latestCandlestick:s.data}}};var Re=(i,t)=>t.topic===i,ee=async(i,t)=>{let {redis:e}=i.server,{topic:o}=i.params,n=[],a=null;switch(o){case E.Enum.BTCUSDT:try{let s=await w.parseKlineTopic(["kline:BTC:24h","kline:BTC:1m"],e);n=s.confirmedCandlesticks,a=s.latestCandlestick;}catch(s){s instanceof ZodError&&(s=s);}break;case E.Enum.ETHUSDT:try{let s=await w.parseKlineTopic(["kline:ETH:24h","kline:ETH:1m"],e);n=s.confirmedCandlesticks,a=s.latestCandlestick;}catch(s){s instanceof ZodError&&(s=s);}break;case E.Enum.TONUSDT:try{let s=await w.parseKlineTopic(["kline:TON:24h","kline:TON:1m"],e);n=s.confirmedCandlesticks,a=s.latestCandlestick;}catch(s){s instanceof ZodError&&(s=s);}break;case E.Enum.SOLUSDT:try{let s=await w.parseKlineTopic(["kline:SOL:24h","kline:SOL:1m"],e);n=s.confirmedCandlesticks,a=s.latestCandlestick;}catch(s){s instanceof ZodError&&(s=s);}break;case E.Enum.BNBUSDT:try{let s=await w.parseKlineTopic(["kline:BNB:24h","kline:BNB:1m"],e);n=s.confirmedCandlesticks,a=s.latestCandlestick;}catch(s){s instanceof ZodError&&(s=s);}break}let d=[];for(let s of n)d.push({open:Number(s.open),close:Number(s.close),high:Number(s.high),low:Number(s.low),time:Number(s.end.toString().slice(0,-3))});return t.code(200).send({list:d,latest:a?{open:Number(a?.open),close:Number(a?.close),high:Number(a?.high),low:Number(a?.low),time:Number(a?.end.toString().slice(0,-3))}:null})},te=async(i,t)=>{let{bybit:e}=t.server;i.on("message",async o=>{try{let a=x.parse(JSON.parse(o.toString())).args;e.ws.on("update",u=>xe(i,u,a));}catch(n){if(n instanceof ZodError){i.send(JSON.stringify({error:n.format()}));return}n instanceof Error&&i.send(JSON.stringify({error:"Invalid JSON payload"}));}});},xe=(i,t,e)=>{for(let o of e)if(Re(`kline.1.${o}`,t))for(let n of t.data)i.send(JSON.stringify({topic:o,data:{high:Number(n.high),low:Number(n.low),open:Number(n.open),close:Number(n.close),time:Number(n.end.toString().slice(0,-3))}}));};function Xe(i){return t=>{let e=t;e.storeUint(306133030,32),e.storeUint(i.queryId,64);}}function We(i){return t=>{let e=t;e.storeUint(3012477066,32),e.storeUint(i.queryId,64);}}function je(i){return t=>{let e=t;e.storeUint(1658160529,32),e.storeUint(i.queryId,64);}}function Oe(i){return t=>{let e=t;e.storeUint(3216336466,32),e.storeUint(i.queryId,64),e.storeAddress(i.subscriber),e.storeInt(i.notificationsCount,257);}}function Ve(i){return t=>{let e=t;e.storeInt(i.start,257),e.storeInt(i.end,257),e.storeInt(i.open,257);let o=new Builder;o.storeInt(i.close,257),o.storeInt(i.high,257),o.storeInt(i.low,257),e.storeRef(o.endCell());}}function z(i){return t=>{let e=t;e.storeUint(990592317,32),e.storeUint(i.queryId,64),e.store(Ve(i.candlestick));}}function Ze(i){return t=>{let e=t;e.storeUint(1031311118,32),e.storeUint(i.queryId,64),e.storeInt(i.batchId,257);}}function $e(i){return t=>{let e=t;e.storeUint(4082513223,32),e.storeUint(i.queryId,64),e.storeAddress(i.session),e.storeInt(i.remainingNotificationsCount,257);}}function _e(i){return t=>{let e=t;e.storeUint(1003141156,32),e.storeUint(i.queryId,64),e.storeAddress(i.session),e.storeInt(i.remainingNotificationsCount,257);}}function et(i){return t=>{let e=t;e.storeUint(269942218,32),e.storeUint(i.queryId,64),e.storeAddress(i.subscriber);}}function tt(i){return t=>{let e=t;e.storeUint(495971614,32),e.storeUint(i.queryId,64),e.storeAddress(i.subscriber),e.storeAddress(i.batch),e.storeInt(i.notificationsCount,257);}}function it(i){return t=>{t.storeInt(i.subscriptionsCount,257);}}function nt(i){return {$$type:"SBInfo",subscriptionsCount:i.loadIntBig(257)}}function ot(){return {serialize:(i,t)=>{t.storeRef(beginCell$1().store(it(i)).endCell());},parse:i=>nt(i.loadRef().beginParse())}}function st(i){return t=>{let e=t;e.storeAddress(i.publisher),e.storeStringRefTail(i.topic);}}async function oe(i,t){let e=Cell$1.fromBase64("te6ccgECUAEADnMAART/APSkE/S88sgLAQIBYgIDAvTQAdDTAwFxsKMB+kABINdJgQELuvLgiCDXCwoggQT/uvLQiYMJuvLgiFRQUwNvBPhhAvhi2zxVE9s88uCCyPhDAcx/AcoAVTBQQyDXSYEBC7ry4Igg1wsKIIEE/7ry0ImDCbry4IjPFshYzxbJAcwS9ACBAQHPAMntVEwGAgEgBAUCASAkJQIBIDY3BPYBjzeAINchcCHXScIflTAg1wsf3oIQ/l6eRbqPGtMfAYIQ/l6eRbry4IHTPwExMIhSQHBt2zx/4DB/4HAh10nCH5UwINcLH94gghASPzgmuo6oMNMfAYIQEj84Jrry4IHTPwExyAGCEOvpIR9Yyx/LP8n4QgFwbds8f+AHGxsIACIAAAAAU0JEZXBsb3lFcnJvcgTWIIIQs47AirqOlTDTHwGCELOOwIq68uCB0z8BMds8f+AgghA9eI8Ouo6bMNMfAYIQPXiPDrry4IHTP4EBAdcAWWwS2zx/4CCCEGLVhZG6jpIw0x8BghBi1YWRuvLggdM/ATHgIIIQEBb9yroJCgsMAvT4QW8kMDJSYMcF8uGQghAF9eEAvvLhkSHBCvLhkvhD+Cgj2zxccFnIcAHLAXMBywFwAcsAEszMyfkAyHIBywFwAcsAEsoHy//J0CDXSYEBC7ry4Igg1wsKIIEE/7ry0ImDCbry4IgDyAGCEP5enkVYyx/LP8kCfwJvAksNAvQw+EFvJBAjXwP4Q/goJNs8cFnIcAHLAXMBywFwAcsAEszMyfkAyHIBywFwAcsAEsoHy//J0CDXSYEBC7ry4Igg1wsKIIEE/7ry0ImDCbry4IhSAscF8uGQgQELcMgBAYEBAc8AySIQNgEgbpUwWfRZMJRBM/QT4gKkA0sOAuL4QW8kMGwSghAF9eEAvvLhkfhD+ChY2zxccFnIcAHLAXMBywFwAcsAEszMyfkAyHIBywFwAcsAEsoHy//J0CDXSYEBC7ry4Igg1wsKIIEE/7ry0ImDCbry4IgDyAGCEFHRjExYyx/LP8kCfwJvAts8f08bA/6OtTDTHwGCEBAW/cq68uCB0z/6QAEg10mBAQu68uCIINcLCiCBBP+68tCJgwm68uCIEmwS2zx/4CCCEL+1ZlK6jrww0x8BghC/tWZSuvLggdM/+kABINdJgQELuvLgiCDXCwoggQT/uvLQiYMJuvLgiAGBAQHXAFUgbBPbPH/gDxARAQTbPBsBashZghBLK3LOUAPLH8s/ASDXSYEBC7ry4Igg1wsKIIEE/7ry0ImDCbry4IjPFslUIkBwbds8GwKw+EFvJBAjXwP4Q/goI9s8cFnIcAHLAXMBywFwAcsAEszMyfkAyHIBywFwAcsAEsoHy//J0CDXSYEBC7ry4Igg1wsKIIEE/7ry0ImDCbry4IhSAscF8uGQEk8SAt74QW8kECNfA/hD+ChBBNs8cFnIcAHLAXMBywFwAcsAEszMyfkAyHIBywFwAcsAEsoHy//J0CDXSYEBC7ry4Igg1wsKIIEE/7ry0ImDCbry4IhSA8cF8uGQIMIB8uGUggiYloAhpah0+wJtU1WBAQtPEwT2IIIQHY/tHrqO3DDTHwGCEB2P7R668uCB0z/6QAEg10mBAQu68uCIINcLCiCBBP+68tCJgwm68uCIAfpAASDXSYEBC7ry4Igg1wsKIIEE/7ry0ImDCbry4IgBgQEB1wBVMGwU2zx/4CCCEPNWNUe64wIgghA7Cz09uuMCFRYXGAFkyFmCEM3JP4ZQA8sfyz8BINdJgQELuvLgiCDXCwoggQT/uvLQiYMJuvLgiM8WyXBt2zwbAfz0g2+lIJESlTFtMm0B4pCONSBukjBtmtCBAQHXAAExbwHiIG7y0IBvIcEUkjIh3oEBCyICWfR0b6UglALUMFiVMW0ybQHi6F8DIG6z8uGTgQELISBu8tCAJ1lZ9AtvoZIwbd8gbpIwbZrQgQEB1wABMW8B4oEBCyIgbvLQgAIUAdQgbvLQgG8hpMgBAYEBAc8AyRA4EiBulTBZ9FkwlEEz9BPiBSBu8tCAcFBDgwYDyFUgghB3TUCiUATLHxLLPwEg10mBAQu68uCIINcLCiCBBP+68tCJgwm68uCIzxaBAQHPAMl/VTBtbds8IgLc+EFvJBAjXwP4Q/goQQXbPHBZyHABywFzAcsBcAHLABLMzMn5AMhyAcsBcAHLABLKB8v/ydAg10mBAQu68uCIINcLCiCBBP+68tCJgwm68uCIUgTHBfLhkCDCAPLhlIIImJaAIah0+wJwUEODBgVPGQFyMNMfAYIQ81Y1R7ry4IHTP/pAASDXSYEBC7ry4Igg1wsKIIEE/7ry0ImDCbry4IgBgQEB1wBVIGwTGgPyMNMfAYIQOws9Pbry4IHTP9s8EGdsF/hBbyQwMlLAxwXy4ZAgghEqBfIAvvLhkSlwIYEBC/SDb6UgkRKVMW0ybQHikIroECNfA2xiggiYloABqPgnbxBYoSGhcPsCgwYCyAGCEAzShkVYyx/LP8kmUDN/VTBtbds8fxwdIgGOghA7yrgkuo670x8BghA7yrgkuvLggdM/+kABINdJgQELuvLgiCDXCwoggQT/uvLQiYMJuvLgiAGBAQHXAFUgbBPbPH/gMHAgAXrIVSCCEA/3lxhQBMsfEss/ASDXSYEBC7ry4Igg1wsKIIEE/7ry0ImDCbry4IjPFoEBAc8AyRN/VTBtbds8IgHQ+EFvJBAjXwMlgQELIln0C2+hkjBt3yBukjBtmtCBAQHXAAExbwHibrPy4ZBDAMhVIIIQ4LdHWFAEyx8Syz8BINdJgQELuvLgiCDXCwoggQT/uvLQiYMJuvLgiM8WgQEBzwDJcG3bPH8bAo5tbSJus5lbIG7y0IBvIgGRMuL4QW8kE18D+CdvEAGhggr68IC5jpSCCvrwgHD7AhAkcAMEgQCCUCPbPOAQJHADBIBCUCPbPCIiAFCBAQHXAIEBAdcAgQEB1wDUAdCBAQHXAIEBAdcAgQEB1wAwEDYQNRA0A/AgbpIwbZrQgQEB1wABMW8B4iBu8tCAbyEgwgCPU4IK+vCAcVR9y1R9yy1WGMhVcIIQ8XYmIlAJyx8Xyz8G2zzIWCDXSYEBC7ry4Igg1wsKIIEE/7ry0ImDCbry4IjPFskBzMkkVSB/VTBtbds8EqABkTDigQELIwIeIh8AUFBWgQEBzwATgQEBzwCBAQHPAAHIgQEBzwASgQEBzwASgQEBzwDJAcwAJFn0dG+lIJQC1DBYlTFtMm0B4gH0+EFvJBAjXwMlgQELIln0C2+hkjBt3yBukjBtmtCBAQHXAAExbwHiIG6z8uGQgQELASBu8tCAbyGlyAEBgQEBzwDJEDcSIG6VMFn0WTCUQTP0E+JwJcIBmTCCCJiWgCWlqN4DgEAGyFmCEEy3oMRQA8sfyz+BAQHPAMkhARJDUH9VMG1t2zwiAcrIcQHKAVAHAcoAcAHKAlAFINdJgQELuvLgiCDXCwoggQT/uvLQiYMJuvLgiM8WUAP6AnABymgjbrORf5MkbrPilzMzAXABygDjDSFus5x/AcoAASBu8tCAAcyVMXABygDiyQH7ACMAmH8BygDIcAHKAHABygAkbrOdfwHKAAQgbvLQgFAEzJY0A3ABygDiJG6znX8BygAEIG7y0IBQBMyWNANwAcoA4nABygACfwHKAALJWMwCASAmJwIBSDM0AhG25dtnm2eNiDBMKAIBICkqAAIhAgEgKywCEbJQds82zxsQYEwyAhGtI+2ebZ42IMBMLQIBai4vAAqCCvrwgAIPow9s82zxsQZMMAIPohds82zxsQZMMQACIgAMghEqBfIAAAqCCJiWgAIRs702zzbPGxBgTEICEbBcts82zxsQYEw1AAIgAgEgODkCASBERQIDntw6OwIBID4/Ag3XbPNs8bEGTDwCD642zzbPGxBgTD0ACPgnbxAACoIJMS0AAgFIQEEAlbL0YJwXOw9XSyuex6E7DnWSoUbZoJwndY1LStkfLMi068t/fFiOYJwIFXAG4BnY5TOWDquRyWyw4JwnZdOWrNOy3M6DpZtlGbopIAIQq4vbPNs8bEFMQgIQqc7bPNs8bEFMQwAMghAF9eEAAAIjAgEgRkcCTbaoRBrpMCAhd15cEQQa4WFEECCf915aETBhN15cERtniqB7Z42IMExNABGwr7tRNDSAAGACASBISQIVr+btniqB7Z42IMBMSgB1rN3Ghq0uDM5nReXqLaomRk9IT0tG7czs7acOKCoGLynKTU6tT0orBybGSOxGS0kObm2qaQ0LSkzukEABkPhD+ChY2zxwWchwAcsBcwHLAXABywASzMzJ+QDIcgHLAXABywASygfL/8nQINdJgQELuvLgiCDXCwoggQT/uvLQiYMJuvLgiEsAogLQ9AQwbQGBKPIBgBD0D2+h8uCHAYEo8iICgBD0F8gByPQAyQHMcAHKAEADWSDXSYEBC7ry4Igg1wsKIIEE/7ry0ImDCbry4IjPFoEBAc8AyQHg7UTQ1AH4Y9IAAY4v+kABINdJgQELuvLgiCDXCwoggQT/uvLQiYMJuvLgiAHUAdAB9ASBAQHXAFUwbBTg+CjXCwqDCbry4In6QAEg10mBAQu68uCIINcLCiCBBP+68tCJgwm68uCIAdQB0BIC0QHbPE4BkPhD+ChY2zxwWchwAcsBcwHLAXABywASzMzJ+QDIcgHLAXABywASygfL/8nQINdJgQELuvLgiCDXCwoggQT/uvLQiYMJuvLgiE8ABG1wANoC0PQEMG0BggCXdwGAEPQPb6Hy4IcBggCXdyICgBD0F8gByPQAyQHMcAHKAEADWSDXSYEBC7ry4Igg1wsKIIEE/7ry0ImDCbry4IjPFgEg10mBAQu68uCIINcLCiCBBP+68tCJgwm68uCIzxbJ"),o=Cell$1.fromBase64("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"),n=beginCell$1();n.storeRef(o),n.storeUint(0,1),st({$$type:"DataStream_init_args",publisher:i,topic:t})(n);let a=n.endCell();return {code:e,data:a}}var at={2:{message:"Stack underflow"},3:{message:"Stack overflow"},4:{message:"Integer overflow"},5:{message:"Integer out of expected range"},6:{message:"Invalid opcode"},7:{message:"Type check error"},8:{message:"Cell overflow"},9:{message:"Cell underflow"},10:{message:"Dictionary error"},13:{message:"Out of gas error"},32:{message:"Method ID not found"},34:{message:"Action is invalid or not supported"},37:{message:"Not enough TON"},38:{message:"Not enough extra-currencies"},128:{message:"Null reference exception"},129:{message:"Invalid serialization prefix"},130:{message:"Invalid incoming message"},131:{message:"Constraints error"},132:{message:"Access denied"},133:{message:"Contract stopped"},134:{message:"Invalid argument"},135:{message:"Code of a contract was not found"},136:{message:"Invalid address"},137:{message:"Masterchain support is not enabled for this contract"}},rt=[{name:"StateInit",header:null,fields:[{name:"code",type:{kind:"simple",type:"cell",optional:!1}},{name:"data",type:{kind:"simple",type:"cell",optional:!1}}]},{name:"Context",header:null,fields:[{name:"bounced",type:{kind:"simple",type:"bool",optional:!1}},{name:"sender",type:{kind:"simple",type:"address",optional:!1}},{name:"value",type:{kind:"simple",type:"int",optional:!1,format:257}},{name:"raw",type:{kind:"simple",type:"slice",optional:!1}}]},{name:"SendParameters",header:null,fields:[{name:"bounce",type:{kind:"simple",type:"bool",optional:!1}},{name:"to",type:{kind:"simple",type:"address",optional:!1}},{name:"value",type:{kind:"simple",type:"int",optional:!1,format:257}},{name:"mode",type:{kind:"simple",type:"int",optional:!1,format:257}},{name:"body",type:{kind:"simple",type:"cell",optional:!0}},{name:"code",type:{kind:"simple",type:"cell",optional:!0}},{name:"data",type:{kind:"simple",type:"cell",optional:!0}}]},{name:"DSTDeploy",header:306133030,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"DSTDeploySuccess",header:3957924127,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"DSTDeployBatch",header:3012477066,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"DSTDeployBatchSuccess",header:1261138638,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"batch",type:{kind:"simple",type:"address",optional:!1}}]},{name:"DSTDeploySession",header:1658160529,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"DSTDeploySessionSuccess",header:3452518278,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"session",type:{kind:"simple",type:"address",optional:!1}}]},{name:"DSTSubscribe",header:3216336466,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"subscriber",type:{kind:"simple",type:"address",optional:!1}},{name:"notificationsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"DSTSubscribeSuccess",header:3770107736,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"batch",type:{kind:"simple",type:"address",optional:!1}},{name:"remainingNotificationsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"Candlestick",header:null,fields:[{name:"start",type:{kind:"simple",type:"int",optional:!1,format:257}},{name:"end",type:{kind:"simple",type:"int",optional:!1,format:257}},{name:"open",type:{kind:"simple",type:"int",optional:!1,format:257}},{name:"close",type:{kind:"simple",type:"int",optional:!1,format:257}},{name:"high",type:{kind:"simple",type:"int",optional:!1,format:257}},{name:"low",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"DSTPublishCandlestick",header:990592317,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"candlestick",type:{kind:"simple",type:"Candlestick",optional:!1}}]},{name:"DSTPublishCandlestickSuccess",header:215123525,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"DSTUnsubscribedNotification",header:1287102660,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"remainingNotificationsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"SBDeploy",header:4267613765,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"SBDeploySuccess",header:1031311118,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"batchId",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"SBSubscribe",header:2001551522,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"session",type:{kind:"simple",type:"address",optional:!1}},{name:"notificationsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"SBSubscribeSuccess",header:4082513223,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"session",type:{kind:"simple",type:"address",optional:!1}},{name:"remainingNotificationsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"SBPublishCandlestick",header:4051052066,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"candlestick",type:{kind:"simple",type:"Candlestick",optional:!1}},{name:"publisher",type:{kind:"simple",type:"address",optional:!1}}]},{name:"SBCandlestickPublishedNotification",header:4175431181,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"candlestick",type:{kind:"simple",type:"Candlestick",optional:!1}},{name:"remainingNotificationsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"SBUnsubscribedNotification",header:1003141156,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"session",type:{kind:"simple",type:"address",optional:!1}},{name:"remainingNotificationsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"SBPublishCandlestickSuccess",header:1027631690,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"SESDeploy",header:1372687436,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"SESDeploySuccess",header:269942218,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"subscriber",type:{kind:"simple",type:"address",optional:!1}}]},{name:"SESSubscribe",header:1533823831,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"notificationsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"DSTTopUpSubscription",header:495971614,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"subscriber",type:{kind:"simple",type:"address",optional:!1}},{name:"batch",type:{kind:"simple",type:"address",optional:!1}},{name:"notificationsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"SBTopUpSubscription",header:267884312,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"session",type:{kind:"simple",type:"address",optional:!1}},{name:"notificationsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"SESSubscribeSuccess",header:1400038355,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"remainingNotificationsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"SESCandlestickPublishedNotification",header:3200926804,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"candlestick",type:{kind:"simple",type:"Candlestick",optional:!1}},{name:"remainingNotificationsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"SESUnsubscribedNotification",header:4092566650,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"remainingNotificationsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"SESUnsubscribe",header:2668625285,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"SBUnsubscribe",header:1095850324,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"SESDestroy",header:2226780297,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"SESDestroySuccess",header:21916563,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"BRGDeploy",header:4195386677,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"BRGDeploySuccess",header:3142995347,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"BRGDeployBroker",header:298971134,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"stream",type:{kind:"simple",type:"address",optional:!1}}]},{name:"BRKDeploy",header:1366331229,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"BRKDeploySuccess",header:2536416450,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"stream",type:{kind:"simple",type:"address",optional:!1}}]},{name:"BRGDeployBrokerSuccess",header:4042145317,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"broker",type:{kind:"simple",type:"address",optional:!1}}]},{name:"BRGDeployAccount",header:3233956202,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"BRADeploy",header:1181556865,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"BRADeploySuccess",header:3517832790,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"trader",type:{kind:"simple",type:"address",optional:!1}}]},{name:"BRGDeployAccountSuccess",header:1962963078,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}},{name:"account",type:{kind:"simple",type:"address",optional:!1}}]},{name:"BRKDeposit",header:2141827764,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"BRKDepositSuccess",header:2064422216,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"BRKWithdraw",header:550691255,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"BRKWithdrawSuccess",header:2654800410,fields:[{name:"queryId",type:{kind:"simple",type:"uint",optional:!1,format:64}}]},{name:"SubscriptionInfo",header:null,fields:[{name:"remainingNotificationsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]},{name:"SBInfo",header:null,fields:[{name:"subscriptionsCount",type:{kind:"simple",type:"int",optional:!1,format:257}}]}],pt=[{name:"balance",arguments:[],returnType:{kind:"simple",type:"int",optional:!1,format:257}},{name:"storageReserve",arguments:[],returnType:{kind:"simple",type:"int",optional:!1,format:257}},{name:"deployBatchDeposit",arguments:[],returnType:{kind:"simple",type:"int",optional:!1,format:257}},{name:"deploySessionDeposit",arguments:[],returnType:{kind:"simple",type:"int",optional:!1,format:257}},{name:"publishCandlestickDeposit",arguments:[],returnType:{kind:"simple",type:"int",optional:!1,format:257}},{name:"notificationDeposit",arguments:[],returnType:{kind:"simple",type:"int",optional:!1,format:257}},{name:"notificationPremium",arguments:[],returnType:{kind:"simple",type:"int",optional:!1,format:257}},{name:"publisherAddress",arguments:[],returnType:{kind:"simple",type:"address",optional:!1}},{name:"topic",arguments:[],returnType:{kind:"simple",type:"string",optional:!1}},{name:"batches",arguments:[],returnType:{kind:"dict",key:"address",value:"SBInfo",valueFormat:"ref"}},{name:"nextBatchId",arguments:[],returnType:{kind:"simple",type:"int",optional:!1,format:257}},{name:"batchAddress",arguments:[{name:"batchId",type:{kind:"simple",type:"int",optional:!1,format:257}}],returnType:{kind:"simple",type:"address",optional:!1}},{name:"sessionAddress",arguments:[{name:"subscriber",type:{kind:"simple",type:"address",optional:!1}}],returnType:{kind:"simple",type:"address",optional:!1}}],At=[{receiver:"internal",message:{kind:"typed",type:"DSTDeploy"}},{receiver:"internal",message:{kind:"typed",type:"DSTDeployBatch"}},{receiver:"internal",message:{kind:"typed",type:"SBDeploySuccess"}},{receiver:"internal",message:{kind:"typed",type:"DSTDeploySession"}},{receiver:"internal",message:{kind:"typed",type:"SESDeploySuccess"}},{receiver:"internal",message:{kind:"typed",type:"DSTSubscribe"}},{receiver:"internal",message:{kind:"typed",type:"DSTTopUpSubscription"}},{receiver:"internal",message:{kind:"typed",type:"SBSubscribeSuccess"}},{receiver:"internal",message:{kind:"typed",type:"DSTPublishCandlestick"}},{receiver:"internal",message:{kind:"typed",type:"SBUnsubscribedNotification"}}],se=class U{constructor(t,e){this.abi={types:rt,getters:pt,receivers:At,errors:at},this.address=t,this.init=e;}static async init(t,e){return await oe(t,e)}static async fromInit(t,e){let o=await oe(t,e),n=contractAddress$1(0,o);return new U(n,o)}static fromAddress(t){return new U(t)}async send(t,e,o,n){let a=null;if(n&&typeof n=="object"&&!(n instanceof Slice)&&n.$$type==="DSTDeploy"&&(a=beginCell$1().store(Xe(n)).endCell()),n&&typeof n=="object"&&!(n instanceof Slice)&&n.$$type==="DSTDeployBatch"&&(a=beginCell$1().store(We(n)).endCell()),n&&typeof n=="object"&&!(n instanceof Slice)&&n.$$type==="SBDeploySuccess"&&(a=beginCell$1().store(Ze(n)).endCell()),n&&typeof n=="object"&&!(n instanceof Slice)&&n.$$type==="DSTDeploySession"&&(a=beginCell$1().store(je(n)).endCell()),n&&typeof n=="object"&&!(n instanceof Slice)&&n.$$type==="SESDeploySuccess"&&(a=beginCell$1().store(et(n)).endCell()),n&&typeof n=="object"&&!(n instanceof Slice)&&n.$$type==="DSTSubscribe"&&(a=beginCell$1().store(Oe(n)).endCell()),n&&typeof n=="object"&&!(n instanceof Slice)&&n.$$type==="DSTTopUpSubscription"&&(a=beginCell$1().store(tt(n)).endCell()),n&&typeof n=="object"&&!(n instanceof Slice)&&n.$$type==="SBSubscribeSuccess"&&(a=beginCell$1().store($e(n)).endCell()),n&&typeof n=="object"&&!(n instanceof Slice)&&n.$$type==="DSTPublishCandlestick"&&(a=beginCell$1().store(z(n)).endCell()),n&&typeof n=="object"&&!(n instanceof Slice)&&n.$$type==="SBUnsubscribedNotification"&&(a=beginCell$1().store(_e(n)).endCell()),a===null)throw new Error("Invalid message type");await t.internal(e,{...o,body:a});}async getBalance(t){let e=new TupleBuilder;return (await t.get("balance",e.build())).stack.readBigNumber()}async getStorageReserve(t){let e=new TupleBuilder;return (await t.get("storageReserve",e.build())).stack.readBigNumber()}async getDeployBatchDeposit(t){let e=new TupleBuilder;return (await t.get("deployBatchDeposit",e.build())).stack.readBigNumber()}async getDeploySessionDeposit(t){let e=new TupleBuilder;return (await t.get("deploySessionDeposit",e.build())).stack.readBigNumber()}async getPublishCandlestickDeposit(t){let e=new TupleBuilder;return (await t.get("publishCandlestickDeposit",e.build())).stack.readBigNumber()}async getNotificationDeposit(t){let e=new TupleBuilder;return (await t.get("notificationDeposit",e.build())).stack.readBigNumber()}async getNotificationPremium(t){let e=new TupleBuilder;return (await t.get("notificationPremium",e.build())).stack.readBigNumber()}async getPublisherAddress(t){let e=new TupleBuilder;return (await t.get("publisherAddress",e.build())).stack.readAddress()}async getTopic(t){let e=new TupleBuilder;return (await t.get("topic",e.build())).stack.readString()}async getBatches(t){let e=new TupleBuilder,o=(await t.get("batches",e.build())).stack;return Dictionary.loadDirect(Dictionary.Keys.Address(),ot(),o.readCellOpt())}async getNextBatchId(t){let e=new TupleBuilder;return (await t.get("nextBatchId",e.build())).stack.readBigNumber()}async getBatchAddress(t,e){let o=new TupleBuilder;return o.writeNumber(e),(await t.get("batchAddress",o.build())).stack.readAddress()}async getSessionAddress(t,e){let o=new TupleBuilder;return o.writeAddress(e),(await t.get("sessionAddress",o.build())).stack.readAddress()}};toNano("0.03");toNano("0.01");toNano("1");toNano("2");var Bt=async i=>{let{redis:t,bybit:e,log:o}=i;e.ws.subscribeV5("kline.1.BTCUSDT","spot");let n=new TonClient({endpoint:"https://testnet.toncenter.com/api/v2/jsonRPC",apiKey:i.config.RPC_PROVIDER_API_KEY}),a=await mnemonicToPrivateKey(i.config.MNEMONIC.split(",")),d=WalletContractV4.create({workchain:0,publicKey:a.publicKey}),s=n.open(d),C=n.open(se.fromAddress(Address.parse(i.config.DATA_STREAM_ADDRESS)));e.ws.on("update",async l=>{switch(l.topic){case"kline.1.BTCUSDT":for(let A of l.data)if(A.confirm){t.pipeline().rpush("kline:BTC:24h",JSON.stringify(A)).ltrim("kline:BTC:24h",-1440,-1).exec();try{let B=await C.getBatches(),h=!1;for(let[P,Q]of B)o.debug("Batch Info: %s",Q.subscriptionsCount.toString()),Q.subscriptionsCount>0?h=!1:h=!0;if(h)return;let N=await s.getSeqno(),M={$$type:"Candlestick",open:BigInt(A.open.split(".").join("")),high:BigInt(A.high.split(".").join("")),low:BigInt(A.low.split(".").join("")),close:BigInt(A.close.split(".").join("")),start:BigInt(A.start.toString().slice(0,-3)),end:BigInt(A.end.toString().slice(0,-3))+1n};o.debug("Publishing Candlestick: %s",JSON.stringify(M,(P,Q)=>typeof Q=="bigint"?Q.toString():Q,2)),await s.sendTransfer({seqno:N,secretKey:a.secretKey,messages:[internal({value:"5",to:i.config.DATA_STREAM_ADDRESS,body:beginCell().store(z({$$type:"DSTPublishCandlestick",queryId:777n,candlestick:M})).endCell()})]});}catch(B){o.error("Error: %s",B);}}else t.set("kline:BTC:1m",JSON.stringify(A));break}}),i.get("/kline/:topic",{schema:{params:r.object({topic:E}),querystring:r.object({token:r.string().optional()}).optional()},preHandler:async(l,A)=>{try{await l.jwtVerify();}catch(B){A.send(B);}}},ee),i.get("/kline",{websocket:!0,preHandler:async(l,A)=>{try{if(l.query&&typeof l.query=="object"&&"token"in l.query){let{token:B}=l.query;l.headers.authorization=`Bearer ${B}`;}await l.jwtVerify();}catch(B){A.send(B);}}},te);},ae=Bt;var re=r.object({address:r.string(),network:r.nativeEnum(S),public_key:r.string(),proof:r.object({timestamp:r.number(),domain:r.object({lengthBytes:r.number(),value:r.string()}),payload:r.string(),signature:r.string(),state_init:r.string()})});async function pe(i,t){try{let e=b.create("-3");if(!await new k().checkProof(i.body,d=>e.getWalletPublicKey(d)))return t.code(400).send({message:"Invalid proof"});if(!i.server.jwt.verify(i.body.proof.payload).toString())return t.code(400).send({message:"Invalid token"});let u=await t.jwtSign({address:i.body.address,network:i.body.network,name:"Vladimir Starkov",email:"test@gmail.com"},{expiresIn:"180d"});return t.code(200).send({message:"Proof is valid",token:u})}catch(e){return console.error(e),t.code(400).send({message:"Invalid request",error:e})}}async function Ae(i,t){try{let o=new k().generatePayload(),n=await t.jwtSign({payload:o},{expiresIn:"15m"});return t.code(200).send({proofToken:n})}catch(e){return console.error(e),t.code(400).send({message:"Invalid request",error:e})}}async function ye(i,t){try{let{address:e,network:o}=i.user,n=b.create(o),{account:a}=await n.getAccountInfo(e);return t.code(200).send({address:e,balance:fromNano(a.balance.coins)})}catch(e){return console.error(e),t.code(400).send({message:"Invalid request",error:e})}}var ct=async i=>{i.post("/check-proof",{schema:{body:re}},pe),i.post("/generate-proof-payload",{},Ae),i.get("/account-info",{preHandler:async(t,e)=>{try{await t.jwtVerify();}catch(o){e.send(o);}}},ye);},de=ct;var Ct=async i=>{await i.register(ae),await i.register(de);},le=Ct;var p=ht({logger:{level:process.env.LOG_LEVEL}}).withTypeProvider();p.setValidatorCompiler(validatorCompiler);p.setSerializerCompiler(serializerCompiler);await p.register(v);await p.register(ft,{origin:"*"});await p.register(Et);await p.register(wt,{secret:p.config.JWT_SECRET});await p.register(bt,{openapi:{openapi:"3.0.0",info:{title:"Test swagger",description:"Testing the Fastify swagger API",version:"0.1.0"},servers:[{url:"http://localhost:3000",description:"Development server"}],tags:[{name:"user",description:"User related end-points"},{name:"code",description:"Code related end-points"}],components:{securitySchemes:{apiKey:{type:"apiKey",name:"apiKey",in:"header"}}},externalDocs:{url:"https://swagger.io",description:"Find more info here"}}});await p.register(Dt,{routePrefix:"/reference",configuration:{spec:{content:()=>p.swagger()}}});await p.register(kt,{options:{maxPayload:1048576}});await p.register(Qt,{url:p.config.REDIS_URI});await p.register(J);p.get("/",(i,t)=>t.code(418).send({message:"I am a teapot"}));await p.register(le);await p.ready();var L=p;process.on("unhandledRejection",i=>{console.error(i),process.exit(1);});var Mt=+L.config.API_PORT,Ht=L.config.API_HOST;await L.listen({host:Ht,port:Mt});for(let i of ["SIGINT","SIGTERM"])process.on(i,()=>L.close().then(t=>{console.log(`close application on ${i}`),process.exit(t?1:0);}));
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map